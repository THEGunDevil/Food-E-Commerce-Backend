// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: cart_items.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const addCartItem = `-- name: AddCartItem :one
INSERT INTO cart_items (
    cart_id,
    menu_item_id,
    quantity,
    special_instructions
) VALUES (
    $1, $2, $3, $4
)
RETURNING id, cart_id, menu_item_id, quantity, special_instructions, created_at, updated_at
`

type AddCartItemParams struct {
	CartID              pgtype.UUID `json:"cart_id"`
	MenuItemID          pgtype.UUID `json:"menu_item_id"`
	Quantity            int32       `json:"quantity"`
	SpecialInstructions pgtype.Text `json:"special_instructions"`
}

func (q *Queries) AddCartItem(ctx context.Context, arg AddCartItemParams) (CartItem, error) {
	row := q.db.QueryRow(ctx, addCartItem,
		arg.CartID,
		arg.MenuItemID,
		arg.Quantity,
		arg.SpecialInstructions,
	)
	var i CartItem
	err := row.Scan(
		&i.ID,
		&i.CartID,
		&i.MenuItemID,
		&i.Quantity,
		&i.SpecialInstructions,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const clearCart = `-- name: ClearCart :exec
DELETE FROM cart_items
WHERE cart_id = $1
`

func (q *Queries) ClearCart(ctx context.Context, cartID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, clearCart, cartID)
	return err
}

const getCartBySessionID = `-- name: GetCartBySessionID :one
SELECT id, user_id, session_id, status, created_at, updated_at
FROM carts
WHERE session_id = $1
`

func (q *Queries) GetCartBySessionID(ctx context.Context, sessionID pgtype.UUID) (Cart, error) {
	row := q.db.QueryRow(ctx, getCartBySessionID, sessionID)
	var i Cart
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.SessionID,
		&i.Status,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getCartItemByCartAndMenuItem = `-- name: GetCartItemByCartAndMenuItem :one
SELECT id, cart_id, menu_item_id, quantity, special_instructions, created_at, updated_at
FROM cart_items
WHERE cart_id = $1
  AND menu_item_id = $2
`

type GetCartItemByCartAndMenuItemParams struct {
	CartID     pgtype.UUID `json:"cart_id"`
	MenuItemID pgtype.UUID `json:"menu_item_id"`
}

func (q *Queries) GetCartItemByCartAndMenuItem(ctx context.Context, arg GetCartItemByCartAndMenuItemParams) (CartItem, error) {
	row := q.db.QueryRow(ctx, getCartItemByCartAndMenuItem, arg.CartID, arg.MenuItemID)
	var i CartItem
	err := row.Scan(
		&i.ID,
		&i.CartID,
		&i.MenuItemID,
		&i.Quantity,
		&i.SpecialInstructions,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getSubTotal = `-- name: GetSubTotal :one
SELECT 
    COALESCE(
        SUM(
            CASE 
                WHEN mi.discount_price > 0 THEN mi.discount_price 
                ELSE mi.price 
            END * c.quantity
        ), 
        0
    )::DECIMAL(10, 2) AS subtotal
FROM cart_items c
JOIN menu_items mi ON c.menu_item_id = mi.id
WHERE c.cart_id = $1
`

func (q *Queries) GetSubTotal(ctx context.Context, cartID pgtype.UUID) (pgtype.Numeric, error) {
	row := q.db.QueryRow(ctx, getSubTotal, cartID)
	var subtotal pgtype.Numeric
	err := row.Scan(&subtotal)
	return subtotal, err
}

const listCartItemsByCart = `-- name: ListCartItemsByCart :many
SELECT id, cart_id, menu_item_id, quantity, special_instructions, created_at, updated_at
FROM cart_items
WHERE cart_id = $1
ORDER BY created_at ASC
`

func (q *Queries) ListCartItemsByCart(ctx context.Context, cartID pgtype.UUID) ([]CartItem, error) {
	rows, err := q.db.Query(ctx, listCartItemsByCart, cartID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CartItem
	for rows.Next() {
		var i CartItem
		if err := rows.Scan(
			&i.ID,
			&i.CartID,
			&i.MenuItemID,
			&i.Quantity,
			&i.SpecialInstructions,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const removeCartItem = `-- name: RemoveCartItem :exec
DELETE FROM cart_items
WHERE menu_item_id = $1
  AND cart_id = $2
`

type RemoveCartItemParams struct {
	MenuItemID pgtype.UUID `json:"menu_item_id"`
	CartID     pgtype.UUID `json:"cart_id"`
}

func (q *Queries) RemoveCartItem(ctx context.Context, arg RemoveCartItemParams) error {
	_, err := q.db.Exec(ctx, removeCartItem, arg.MenuItemID, arg.CartID)
	return err
}

const updateCartItem = `-- name: UpdateCartItem :one
UPDATE cart_items
SET
    quantity = $3,
    updated_at = CURRENT_TIMESTAMP
WHERE menu_item_id = $1 AND cart_id = $2
RETURNING id, cart_id, menu_item_id, quantity, special_instructions, created_at, updated_at
`

type UpdateCartItemParams struct {
	MenuItemID pgtype.UUID `json:"menu_item_id"`
	CartID     pgtype.UUID `json:"cart_id"`
	Quantity   int32       `json:"quantity"`
}

func (q *Queries) UpdateCartItem(ctx context.Context, arg UpdateCartItemParams) (CartItem, error) {
	row := q.db.QueryRow(ctx, updateCartItem, arg.MenuItemID, arg.CartID, arg.Quantity)
	var i CartItem
	err := row.Scan(
		&i.ID,
		&i.CartID,
		&i.MenuItemID,
		&i.Quantity,
		&i.SpecialInstructions,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
